<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬ÙƒÙ„ÙŠØªÙ‡ - Ø¯Ø±Ø¯Ø´Ø© ÙØ§ÙŠØ¨Ø±Ø¨ÙŠØ³ Ø§Ù„ÙØ§Ø®Ø±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ù†ÙŠÙˆÙ…ÙˆØ±ÙÙŠ */
        :root {
            --bg-color: #273041;
            --main-gradient: linear-gradient(135deg, #FF69B4, #8A2BE2); /* Hot Pink to Blue Violet */
            --shadow-light: #364052;
            --shadow-dark: #1f2735;
        }

        body { 
            font-family: 'Cairo', 'Inter', sans-serif; 
            overscroll-behavior: contain; 
            background-color: var(--bg-color); /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø© */
            color: #E2E8F0;
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù†ÙŠÙˆÙ…ÙˆØ±ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø§Ø±Ø²Ø©) */
        .neumo-card {
            background-color: var(--bg-color);
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            border: none;
            transition: all 0.2s ease-in-out;
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù†ÙŠÙˆÙ…ÙˆØ±ÙÙŠØ© Ù„Ù„Ø­Ù‚ÙˆÙ„ (Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©/Ø§Ù„ØºØ§Ø¦Ø±Ø©) */
        .neumo-input {
            background-color: var(--bg-color);
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            border: none;
            color: #E2E8F0;
        }

        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: #8A2BE2; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #FF69B4; }

        /* ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        .chat-bubble-sent { border-bottom-right-radius: 0.25rem; background: var(--main-gradient); }
        .chat-bubble-received { border-bottom-left-radius: 0.25rem; background-color: #364052; box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light); }
    </style>
</head>
<body class="neumo-body">

    <div class="flex flex-col h-screen max-w-lg mx-auto neumo-card rounded-xl">

        <header class="flex items-center justify-between p-4 neumo-card rounded-t-xl">
            <div class="flex items-center gap-3">
                <div id="user-avatar" class="w-10 h-10 rounded-full neumo-input flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white">Ø¬ÙƒÙ„ÙŠØªÙ‡ Ø§Ù„ÙØ§Ø®Ø±Ø©</h1>
                    <p id="current-user-status" class="text-xs text-slate-400">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ØºÙŠØ± Ù…Ø³Ø¬Ù„</p>
                </div>
            </div>
            <button id="user-toggle-btn" class="px-3 py-1 neumo-card rounded-full text-sm font-medium hover:scale-105 transition-transform">
                ØªØ¨Ø¯ÙŠÙ„
            </button>
            <button id="auth-btn" class="p-2 neumo-card rounded-full hover:scale-105 transition-transform">
                <svg id="auth-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in text-pink-400">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                    <polyline points="10 17 15 12 10 7"/>
                    <line x1="15" y1="12" x2="3" y2="12"/>
                </svg>
            </button>
        </header>

        <main id="chat-area" class="flex-1 overflow-y-auto p-4 space-y-4">
            </main>

        <footer class="p-3 neumo-card rounded-b-xl">
            <div class="flex items-center gap-2">
                <button id="functions-btn" class="p-2 text-slate-400 neumo-card rounded-full hover:text-pink-400 transition-colors duration-200 hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                </button>
                <input type="text" id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." class="flex-1 px-4 py-2.5 rounded-full neumo-input placeholder-slate-500 focus:ring-0">
                <button id="send-btn" class="p-2.5 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white shadow-lg hover:scale-110 active:scale-95 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up">
                        <line x1="12" y1="19" x2="12" y2="5"></line>
                        <polyline points="5 12 12 5 19 12"></polyline>
                    </svg>
                </button>
            </div>
        </footer>

        <div id="toast-notification" class="hidden absolute bottom-20 right-4 bg-gray-900 text-white text-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 transform translate-y-2 opacity-0">
            ØªÙ…!
        </div>
    </div>

    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden transition-opacity duration-300">
        <div class="neumo-card p-8 rounded-xl w-11/12 max-w-sm text-center transform transition-transform duration-300 scale-95" id="auth-content">
            <h2 class="text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-400">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø¬ÙƒÙ„ÙŠØªÙ‡</h2>
            
            <p class="text-sm text-slate-400 mb-8">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</p>

            <button id="google-sign-in-btn" class="w-full mb-4 py-3 neumo-card rounded-xl text-white font-semibold flex items-center justify-center transition-all hover:scale-[1.02] active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 48 48">
                    <path fill="#4285F4" d="M24 9.5c3.54 0 6.71 1.24 9.17 3.63l5.24-5.06C34.72 5.52 29.7 4 24 4 14.83 4 7 9.8 7 18.5s7.83 14.5 17 14.5c4.77 0 9.07-1.48 12.35-4.04l-4.52-3.32C31.57 28.66 28.16 29.5 24 29.5c-6.18 0-11.23-4.73-11.23-10.5S17.82 8.5 24 8.5z"/>
                    <path fill="#34A853" d="M43.71 24.38a1.05 1.05 0 0 1 .05.74v.1a1.05 1.05 0 0 1-.05.74L36.85 30l-3.32-2.45c1.8-1.5 2.87-3.73 2.87-6.09s-1.07-4.59-2.87-6.09l3.32-2.45 6.86 5.09z"/>
                    <path fill="#FBBC04" d="M24 44c5.11 0 9.54-1.85 12.87-5.05L32 35.86c-2.31 2.06-5.46 3.39-8 3.39-6.9 0-12.72-4.63-14.86-11.1H4.6c2.8 5.75 9.4 10.33 19.4 10.33z"/>
                    <path fill="#EA4335" d="M4.6 24c0-1.89.37-3.7.99-5.35h-3.95c-.44 1.76-.64 3.64-.64 5.35s.2 3.59.64 5.35h3.95c-.62-1.65-.99-3.46-.99-5.35z"/>
                </svg>
                
                <span class="text-slate-200">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google</span>
            </button>
            
            <div class="flex items-center my-4">
                <div class="flex-grow border-t border-slate-700"></div>
                <span class="mx-4 text-sm text-slate-500">Ø£Ùˆ</span>
                <div class="flex-grow border-t border-slate-700"></div>
            </div>

            <button id="email-sign-in-btn" class="w-full mb-4 py-3 neumo-card rounded-xl text-white font-semibold transition-all hover:scale-[1.02] active:scale-95 bg-gradient-to-r from-purple-600 to-pink-500">
                Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            </button>

            <button id="modal-close-btn" class="mt-6 text-sm text-slate-400 hover:text-white transition-colors">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    </div>

    <script type="module">
        // 1. Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ¸Ø§Ø¦Ù Firebase Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";
        // ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"; 

        // Your web app's Firebase configuration (Ù…ÙØ§ØªÙŠØ­Ùƒ)
        const firebaseConfig = {
            apiKey: "AIzaSyB7skwnEpn3oyu5dH5Tp0sjTCk4DKUWp5k",
            authDomain: "mmnddn-b8def.firebaseapp.com",
            projectId: "mmnddn-b8def",
            storageBucket: "mmnddn-b8def.firebasestorage.app",
            messagingSenderId: "625803051222",
            appId: "1:625803051222:web:785c87e42948320d974977",
            measurementId: "G-ZM860ENPX2"
        };

        // 2. ØªÙ‡ÙŠØ¦Ø© Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 

        // **NEW: Ù…ØªØºÙŠØ±Ø§Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¤Ù‚ØªØ© (Ø³Ù†Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹)**
        let currentUser = "Mahmoud"; 
        const USER_VIEWING_APP = "Mahmoud"; 


        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const chatArea = document.getElementById('chat-area');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const userToggleBtn = document.getElementById('user-toggle-btn');
        const currentUserStatus = document.getElementById('current-user-status');
        const userAvatar = document.getElementById('user-avatar');
        const toast = document.getElementById('toast-notification');
        
        // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const authBtn = document.getElementById('auth-btn'); 
        const authModal = document.getElementById('auth-modal'); // Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const googleSignInBtn = document.getElementById('google-sign-in-btn');
        const emailSignInBtn = document.getElementById('email-sign-in-btn');


        // ÙˆØ¸ÙŠÙØ© Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†Ø¨Ø«Ù‚
        function showToast(message) {
            toast.textContent = message;
            toast.classList.remove('hidden', 'opacity-0', 'translate-y-2');
            toast.classList.add('opacity-100', 'translate-y-0');
            
            setTimeout(() => {
                toast.classList.remove('opacity-100', 'translate-y-0');
                toast.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000); 
        }

        // Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function openModal() {
            authModal.classList.remove('hidden');
            // ØªØ£Ø«ÙŠØ± ØªØ­ÙˆÙ„ Ø¨Ø³ÙŠØ·
            setTimeout(() => {
                document.getElementById('auth-content').classList.remove('scale-95');
            }, 50);
        }

        // Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function closeModal() {
            document.getElementById('auth-content').classList.add('scale-95');
            setTimeout(() => {
                authModal.classList.add('hidden');
            }, 300); // ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ù…Ø¯Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©)
        function updateUIForCurrentUser() {
            currentUserStatus.textContent = `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentUser}`; 
        }
        updateUIForCurrentUser();

        // 3. Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function addMessageToUI(doc) {
            const data = doc.data();
            const messageTime = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }) : 'Ø§Ù„Ø¢Ù†';
            
            const type = data.user === USER_VIEWING_APP ? 'sent' : 'received';

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', type === 'sent' ? 'justify-end' : 'justify-start');
            
            // ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            let bubbleColor = type === 'sent' 
                ? 'bg-gradient-to-br from-pink-500 to-purple-600 text-white shadow-md' // Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø³Ù„Ø©
                : 'chat-bubble-received text-slate-200 shadow-inner'; // Ø±Ø³Ø§Ù„Ø© Ù…Ø³ØªÙ„Ù…Ø©
            
            let bubbleShape = type === 'sent' ? 'chat-bubble-sent' : 'chat-bubble-received';

            messageDiv.innerHTML = `
                <div class="${bubbleColor} p-3 rounded-2xl ${bubbleShape} max-w-[80%]">
                    <p>${data.text}</p>
                    <span class="text-xs ${type === 'sent' ? 'text-white/70' : 'text-slate-400'} mt-1 block text-left">${messageTime}</span>
                </div>
            `;
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // 4. Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¥Ù„Ù‰ Firestore
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '') return;
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ± currentUser Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø³Ù„ (Ù…Ø¤Ù‚ØªØ§Ù‹)
                await addDoc(collection(db, "messages"), {
                    text: message,
                    createdAt: serverTimestamp(), 
                    user: currentUser 
                });
                
                messageInput.value = '';
                
            } catch (e) {
                showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„! Ø§Ù†Ø¸Ø± Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„."); 
                console.error("Error adding document: ", e);
            }
        }

        // 5. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© - ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        async function handleAuthAction() {
            openModal();
        }

        async function handleEmailSignIn() {
             // âš ï¸ Ù†Ø³ØªØ®Ø¯Ù… prompt Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ØŒ ÙˆØ³Ù†Ø¨Ø¯Ù„Ù‡ Ø¨ÙˆØ§Ø¬Ù‡Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
            closeModal(); 
            
            const email = prompt("Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„ØªØ³Ø¬ÙŠÙ„/Ø§Ù„Ø¯Ø®ÙˆÙ„:");
            if (email === null) return; 

            const password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± (6+ Ø£Ø­Ø±Ù):");

            if (!email || !password) {
                showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.");
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                showToast(`ğŸ‰ ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userCredential.user.email}`);
                console.log("Registered User:", userCredential.user);

            } catch (error) {
                showToast(`âŒ ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${error.code}`);
                console.error("Registration Error:", error.message);
            }
        }
        
        function handleGoogleSignIn() {
             closeModal();
             showToast("ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google. Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©!");
        }

        // 6. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
        const q = query(collection(db, "messages"), orderBy("createdAt", "asc"));

        onSnapshot(q, (snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === "added") {
                    addMessageToUI(change.doc);
                }
            });
        });


        // 7. Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        userToggleBtn.addEventListener('click', () => {
            currentUser = currentUser === "Mahmoud" ? "Fatima" : "Mahmoud";
            updateUIForCurrentUser();
            showToast(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰: ${currentUser} - (Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©)`);
        });

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        authBtn.addEventListener('click', handleAuthAction); // Ù„ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        modalCloseBtn.addEventListener('click', closeModal); // Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        authModal.addEventListener('click', (e) => { // Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            if (e.target === authModal) {
                closeModal();
            }
        });
        googleSignInBtn.addEventListener('click', handleGoogleSignIn); // Ø²Ø± Ø¬ÙˆØ¬Ù„ (Ø®Ø·ÙˆØ© Ù‚Ø§Ø¯Ù…Ø©)
        emailSignInBtn.addEventListener('click', handleEmailSignIn); // Ø²Ø± Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
        
    </script>

</body>
</html>
